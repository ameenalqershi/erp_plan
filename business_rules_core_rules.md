# القواعد العامة المشتركة (Core Business Rules Validation)

---

## 1. التحقق من صلاحية المستخدم والعمليات
- لا يمكن تنفيذ أي عملية (إضافة/تعديل/حذف) إلا إذا كان المستخدم يمتلك الصلاحية المناسبة (permission).
- التأكد من صلاحيات الفروع، الأقسام، الفترة المالية المرتبطة.

## 2. التحقق من الفترة المالية
- لا يسمح بأي عملية تقع بتاريخ خارج فترة مالية مفتوحة وغير مغلقة.
- يجب مراجعة أن التاريخ المدخل بين start_date وend_date للفترة المالية المطلوبة وأن status = "نشطة".

## 3. التحقق من البيانات الإلزامية
- جميع الحقول الإلزامية (NOT NULL) يجب تعبئتها قبل حفظ أي سجل.
- في حالات الربط (حقل FK)، يجب التأكد أن المرجع موجود ومفعل.

## 4. منع التعديل بعد الاعتماد أو الإغلاق
- لا يمكن تعديل أو حذف أي سجل إذا كانت حالته معتمدة/مدفوعة/مقفلة، أو الفترة مغلقة.

## 5. التحقق من مراجع الربط
- التأكد من صحة وجود السجلات المرتبطة (العملاء، الموردين، الأصناف، الحسابات، ...).
- التأكد أن السجلات المرتبطة “نشطة” وليست محذوفة/موقوفة.

## 6. التحقق من القيم الرقمية
- عدم السماح بقيم سالبة في الحقول الموجبة (الكمية، القيمة، الرصيد، ...).
- التأكد من الدقة العشرية حسب إعدادات النظام.

## 7. التحقق من التواريخ المنطقية
- أي تاريخ انتهاء يجب أن يكون بعد تاريخ البداية (عقود، مشاريع، إجازات، ...).
- لا يسمح بتواريخ في المستقبل في بعض العمليات (مثلاً: الحضور والانصراف).

## 8. التحقق من التكرار الفريد
- القيم الفريدة (الكود، رقم الهوية، رقم الفاتورة، ...) لا تتكرر.

## 9. التحقق من القيم الافتراضية
- إذا لم يتم إدخال قيمة، يتم تعيين القيمة الافتراضية من إعدادات النظام أو الوحدة.

---

## ملاحظات
- جميع القواعد تطبق في الباك اند بشكل إلزامي.
- يفضل إضافة اختبارات وحدات لكل قاعدة.
- يمكن للقواعد العامة أن تُستدعى من كل خدمة/قسم عند الحاجة.